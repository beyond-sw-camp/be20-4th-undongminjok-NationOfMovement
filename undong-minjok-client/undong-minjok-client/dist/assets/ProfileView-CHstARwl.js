import{z as U,_ as Oe,u as He,r as n,p as re,a as je,c as s,o,d as e,n as E,F as b,A as I,B as ue,t as r,e as u,v as p,g as ze,P as Ge,C as ve,f as v,w as Ke,D as pe,E as N,G as Je,H as We}from"./index-Cu44W2Vv.js";import{u as Qe}from"./passwordSearchStore-BJdo95vH.js";const Xe=()=>U.get("/users/me"),Ye=_=>U.patch("/users/nickname",{nickname:_}),Ze=_=>U.patch("/users/bio",{bio:_}),et=_=>{const y=new FormData;return y.append("file",_),U.post("/users/profile-image",y,{headers:{"Content-Type":"multipart/form-data"}})},tt=()=>U.delete("/users"),at=_=>U.post("/users/reset-password",_).then(y=>y.data),lt={class:"mypage"},st={key:0,class:"mypage-shell"},ot={class:"sidebar"},nt={class:"sidebar-menu"},it=["onClick"],dt={class:"content"},ct={key:0,class:"card"},rt={class:"profile-top"},ut={class:"profile-image-wrap"},vt={class:"profile-image"},pt=["src"],mt={key:1,class:"profile-placeholder"},yt={class:"profile-main"},ht={class:"field"},ft={class:"readonly-box"},_t={class:"field-row"},bt={key:0,class:"btn-group"},kt={class:"field"},gt={class:"readonly-box"},wt={class:"field"},Ct={class:"field-footer-between"},Et={key:0,class:"btn-group"},It={key:1},Pt={key:1,class:"card"},Vt={key:2,class:"card"},Dt={class:"history-header"},Ut={class:"history-count"},St={key:0,class:"empty-text"},At={key:1,class:"empty-text"},Mt={key:2,class:"history-table history-table--purchase"},Tt=["onClick"],Nt={class:"col col-name"},Rt={class:"col col-price"},Bt={class:"col col-date"},xt={key:3,class:"card"},Ft={class:"history-header"},Lt={class:"history-count"},$t={key:0,class:"empty-text"},qt={key:1,class:"empty-text"},Ot={key:2,class:"history-table history-table--sales"},Ht={class:"col col-name"},jt={class:"col col-sales"},zt={class:"col col-price"},Gt={class:"col col-date"},Kt={class:"col col-actions"},Jt=["onClick"],Wt=["onClick"],Qt={key:1,class:"loading-text"},Xt={key:2,class:"modal-backdrop"},Yt={class:"modal"},Zt={class:"modal-actions"},ea={key:0,class:"modal-backdrop"},ta={class:"modal"},aa={class:"field-row",style:{"margin-bottom":"12px"}},la={class:"readonly-box",style:{flex:"1","text-align":"left"}},sa=["disabled"],oa={key:0},na={key:1},ia={key:2},da={class:"field-row",style:{"margin-bottom":"8px"}},ca=["disabled"],ra=["disabled"],ua={key:0,class:"success"},va={key:1,class:"error"},pa={key:2,class:"timer"},ma={class:"modal-actions"},ya={class:"modal-container"},ha={class:"modal-body-grid"},fa={class:"left-panel"},_a={class:"section"},ba={class:"day-tabs"},ka=["onClick"],ga={class:"exercise-section"},wa=["onUpdate:modelValue"],Ca=["onUpdate:modelValue"],Ea=["onUpdate:modelValue"],Ia=["onUpdate:modelValue"],Pa=["onUpdate:modelValue","onChange"],Va=["value"],Da=["onUpdate:modelValue"],Ua=["value"],Sa=["onClick"],Aa={class:"right-panel"},Ma={class:"image-box"},Ta={class:"image-preview-frame"},Na=["src"],Ra={key:1,class:"image-preview empty"},Ba={class:"image-box"},xa={class:"image-preview-frame"},Fa=["src"],La={key:1,class:"image-preview empty"},$a={__name:"ProfileView",setup(_){const y=He(),z="http://localhost:8888/uploads/",G=n(!0),h=n({loginId:"",nickname:"",email:"",profileImagePath:null,amount:0}),k=n(""),g=n(""),K=n(null),P=n("info"),me=[{key:"info",label:"내 정보"},{key:"points",label:"포인트 이력"},{key:"purchases",label:"구매 내역"},{key:"sales",label:"판매 내역"}],R=async()=>{G.value=!0;try{const t=(await Xe()).data.data;h.value=t,k.value=t.nickname,g.value=t.bio||"",K.value=t.profileImagePath?z+t.profileImagePath:"/default.png",y.$patch({user:{...y.user,...t}})}catch(l){console.error("내 정보 로드 실패",l)}finally{G.value=!1}};re(()=>{R()});const ae=n(!1),ye=async()=>{const l=k.value.trim();if(l===h.value.nickname){alert("변경된 내용이 없습니다.");return}if(l){ae.value=!0;try{await Ye(k.value.trim()),await R(),alert("닉네임이 변경되었습니다.")}catch(t){const a=t.response?.data?.message||"닉네임 변경 실패";alert(a)}finally{ae.value=!1}}},le=n(!1),he=async()=>{if(g.value.trim()===(h.value.bio||"")){alert("변경된 내용이 없습니다.");return}le.value=!0;try{await Ze(g.value),await R(),alert("자기소개가 변경되었습니다.")}catch{alert("자기소개 변경 실패")}finally{le.value=!1}},J=n(!1),se=n(null),fe=()=>se.value?.click(),_e=async l=>{const t=l.target.files[0];if(t){J.value=!0;try{await et(t),await R(),alert("프로필 이미지가 변경되었습니다.")}catch{alert("이미지 업로드 실패")}finally{J.value=!1,l.target.value=""}}},W=n(!1),oe=n(""),be=()=>{W.value=!0,oe.value=k.value},ke=()=>{W.value=!1,k.value=oe.value},Q=n(!1),ne=n(""),ge=()=>{Q.value=!0,ne.value=g.value},we=()=>{Q.value=!1,g.value=ne.value},X=n(!1),Ce=async()=>{try{await tt(),alert("회원 탈퇴가 완료되었습니다."),y.logout(),window.location.replace("/"),window.location.reload()}catch{alert("탈퇴 실패")}},d=Qe(),Y=n(!1),w=n(""),B=n(""),Ee=()=>{d.startFlow("PASSWORD_RESET"),w.value="",B.value="",Y.value=!0},Ie=async()=>{if(d.sending)return;await d.sendCode(h.value.email)&&(alert("인증번호가 이메일로 발송되었습니다."),d.codeSent=!0)},Pe=async()=>{await d.verifyCode(h.value.email,d.code)&&alert("인증되었습니다!")},Ve=async()=>{if(!d.emailVerified)return alert("이메일 인증이 필요합니다.");if(!w.value||w.value.length<6)return alert("비밀번호는 6자리 이상이어야 합니다.");if(w.value!==B.value)return alert("비밀번호가 서로 일치하지 않습니다.");try{await at({resetToken:d.resetToken,newPassword:w.value}),alert("비밀번호가 성공적으로 변경되었습니다. 다시 로그인해주세요."),y.logout(),window.location.replace("/"),window.location.reload()}catch{alert("비밀번호 변경에 실패했습니다.")}},x=n([]),F=n([]),L=n(!1),$=n(!1),De=async()=>{if(!L.value){L.value=!0;try{const l=await N.getMyPurchaseHistory();x.value=l.data.data||[]}catch(l){console.error("구매 내역 조회 실패",l)}finally{L.value=!1}}},Z=async()=>{if(!$.value){$.value=!0;try{const l=await N.getMySalesHistory();F.value=l.data.data||[]}catch(l){console.error("판매 내역 조회 실패",l)}finally{$.value=!1}}},Ue=je(),Se=l=>{l&&Ue.push({name:"TemplateDetail",params:{id:l}})},q=n(!1),ee=n(null),ie=n([]),O=n({}),Ae=async()=>{try{const l=await Je.getParts();ie.value=l.data.data||[]}catch(l){console.error("부위 목록 로드 실패",l)}},de=async l=>{if(l&&!O.value[l])try{const t=await We.getEquipmentsByPart(l);O.value={...O.value,[l]:t.data.data||[]}}catch(t){console.error("장비 목록 로드 실패",t)}},Me=async l=>{ee.value=l,await Ae(),await Te(l);const t=new Set;Object.values(m.value).forEach(a=>{a.forEach(c=>{c.part&&t.add(c.part)})});for(const a of t)await de(a);q.value=!0},S=n(""),A=n(""),V=n(0),H=n(null),j=n(null),M=n(null),T=n(null),C=n(1),te=()=>({1:[],2:[],3:[],4:[],5:[],6:[],7:[]}),m=n(te()),Te=async l=>{S.value="",A.value="",V.value=0,H.value=null,j.value=null,M.value=null,T.value=null,C.value=1,m.value=te();try{const a=(await N.getDetail(l)).data.data;if(S.value=a.name,A.value=a.content,V.value=a.price,a.thumbnailImage&&(M.value=z+a.thumbnailImage),a.templateImage&&(T.value=z+a.templateImage),a.days&&Array.isArray(a.days)){const c=te();a.days.forEach(i=>{const D=i.day;c[D]||(c[D]=[]),(i.exercises||[]).forEach((f,qe)=>{c[D].push({day:D,name:f.name||"",part:f.part||null,reps:f.reps??null,weight:f.weight??null,duration:f.duration??null,orderIndex:f.orderIndex??qe+1,equipmentId:f.equipmentId??null})})}),m.value=c}}catch(t){console.error("템플릿 상세 조회 실패",t)}},ce=()=>{q.value=!1},Ne=()=>{const l=C.value;m.value[l]||(m.value[l]=[]),m.value[l].push({day:l,name:"",part:null,reps:null,weight:null,duration:null,orderIndex:m.value[l].length+1,equipmentId:null})},Re=l=>{const t=C.value;m.value[t]&&m.value[t].splice(l,1)},Be=async l=>{if(!l.part){l.equipmentId=null;return}await de(l.part),l.equipmentId=null},xe=l=>{const t=l.target.files[0];t&&(H.value=t,M.value=URL.createObjectURL(t))},Fe=l=>{const t=l.target.files[0];t&&(j.value=t,T.value=URL.createObjectURL(t))},Le=async()=>{if(!ee.value)return;const l=[];for(let c=1;c<=7;c++)(m.value[c]||[]).forEach((D,f)=>{l.push({...D,day:c,orderIndex:f+1})});const t={name:S.value,content:A.value,price:V.value,status:V.value>0?"PAID":"FREE",exercises:l},a=new FormData;a.append("data",JSON.stringify(t)),H.value&&a.append("thumbnail",H.value),j.value&&a.append("detailImage",j.value);try{await N.updateTemplate(ee.value,a),alert("템플릿이 수정되었습니다."),q.value=!1,Z()}catch(c){console.error("템플릿 수정 실패",c),alert("템플릿 수정 중 오류가 발생했습니다.")}},$e=async l=>{if(confirm("정말 삭제하시겠습니까?"))try{await N.deleteTemplate(l),alert("템플릿이 삭제되었습니다."),Z()}catch(t){console.error("템플릿 삭제 실패",t),alert("삭제 중 오류가 발생했습니다.")}};return re(()=>{De(),Z()}),(l,t)=>(o(),s(b,null,[e("div",lt,[G.value?(o(),s("div",Qt,"불러오는 중...")):(o(),s("div",st,[e("aside",ot,[t[11]||(t[11]=e("h2",{class:"sidebar-title"},"마이페이지",-1)),e("nav",nt,[(o(),s(b,null,I(me,a=>e("button",{key:a.key,class:ue(["menu-item",{active:P.value===a.key}]),onClick:c=>P.value=a.key},r(a.label),11,it)),64))])]),e("section",dt,[P.value==="info"?(o(),s("div",ct,[t[16]||(t[16]=e("h3",{class:"card-title"},"내 정보",-1)),e("div",rt,[e("div",ut,[e("div",vt,[K.value?(o(),s("img",{key:0,src:K.value},null,8,pt)):(o(),s("div",mt,r(h.value.nickname?.[0]||"U"),1))]),e("button",{class:"btn-outline",onClick:fe},r(J.value?"업로드 중...":"이미지 변경"),1),e("input",{type:"file",ref_key:"fileInput",ref:se,accept:"image/*",class:"file-input-hidden",onChange:_e},null,544)]),e("div",yt,[e("div",ht,[t[12]||(t[12]=e("label",null,"이메일",-1)),e("div",ft,r(h.value.email),1)]),e("div",_t,[u(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>k.value=a),class:"input"},null,512),[[p,k.value]]),W.value?(o(),s("div",bt,[e("button",{class:"btn-red",onClick:ye},"저장"),e("button",{class:"btn-outline",onClick:ke},"취소")])):(o(),s("button",{key:1,class:"btn-outline",onClick:be},"수정"))]),e("div",kt,[t[13]||(t[13]=e("label",null,"잔여 포인트",-1)),e("div",gt,r(h.value.amount)+" P",1)]),e("div",{class:"field"},[t[14]||(t[14]=e("label",null,"비밀번호",-1)),e("button",{class:"btn-outline",onClick:Ee},"비밀번호 변경")])])]),e("div",wt,[t[15]||(t[15]=e("label",null,"자기소개",-1)),u(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=a=>g.value=a),class:"textarea",maxlength:"200"},null,512),[[p,g.value]]),e("div",Ct,[e("button",{class:"delete-account-btn",onClick:t[2]||(t[2]=a=>X.value=!0)},"회원 탈퇴"),Q.value?(o(),s("div",Et,[e("button",{class:"btn-red",onClick:he},"저장"),e("button",{class:"btn-outline",onClick:we},"취소")])):(o(),s("div",It,[e("button",{class:"btn-outline",onClick:ge},"수정")]))])])])):P.value==="points"?(o(),s("div",Pt,[t[17]||(t[17]=e("h3",{class:"card-title"},"포인트 이력",-1)),ze(Ge)])):P.value==="purchases"?(o(),s("div",Vt,[e("div",Dt,[t[18]||(t[18]=e("h3",{class:"card-title"},"구매 내역",-1)),e("span",Ut,"총 "+r(x.value.length)+"개",1)]),L.value?(o(),s("div",St,"불러오는 중...")):x.value.length?(o(),s("div",Mt,[t[20]||(t[20]=ve('<div class="history-row history-row--head" data-v-1a419531><div class="col col-name" data-v-1a419531>NAME</div><div class="col col-desc" data-v-1a419531>DESCRIPTION</div><div class="col col-price" data-v-1a419531>PRICE</div><div class="col col-date" data-v-1a419531>DATE</div></div>',1)),(o(!0),s(b,null,I(x.value,a=>(o(),s("div",{key:a.templateId,class:"history-row history-row--clickable",onClick:c=>Se(a.templateId)},[e("div",Nt,r(a.templateName),1),t[19]||(t[19]=e("div",{class:"col col-desc"},"구매한 운동 템플릿입니다.",-1)),e("div",Rt,r(a.price)+" P",1),e("div",Bt,r(new Date(a.purchasedAt).toLocaleDateString("ko-KR")),1)],8,Tt))),128))])):(o(),s("div",At,"구매 내역이 없습니다."))])):P.value==="sales"?(o(),s("div",xt,[e("div",Ft,[t[21]||(t[21]=e("h3",{class:"card-title"},"판매 내역",-1)),e("span",Lt,"총 "+r(F.value.length)+"개",1)]),$.value?(o(),s("div",$t,"불러오는 중...")):F.value.length?(o(),s("div",Ot,[t[23]||(t[23]=ve('<div class="history-row history-row--head" data-v-1a419531><div class="col col-name" data-v-1a419531>NAME</div><div class="col col-desc" data-v-1a419531>DESCRIPTION</div><div class="col col-sales" data-v-1a419531>SALES</div><div class="col col-price" data-v-1a419531>PRICE</div><div class="col col-date" data-v-1a419531>DATE</div><div class="col col-actions" data-v-1a419531></div></div>',1)),(o(!0),s(b,null,I(F.value,a=>(o(),s("div",{key:a.templateId,class:"history-row"},[e("div",Ht,r(a.templateName),1),t[22]||(t[22]=e("div",{class:"col col-desc"},"내가 판매한 운동 템플릿입니다.",-1)),e("div",jt,r(a.salesCount)+" 개",1),e("div",zt,r(a.price)+" P",1),e("div",Gt,r(new Date(a.createdAt).toLocaleDateString("ko-KR")),1),e("div",Kt,[e("button",{class:"list-btn list-btn--edit",onClick:c=>Me(a.templateId)},"수정",8,Jt),e("button",{class:"list-btn list-btn--delete",onClick:c=>$e(a.templateId)},"삭제",8,Wt)])]))),128))])):(o(),s("div",qt,"판매 내역이 없습니다."))])):E("",!0)])])),X.value?(o(),s("div",Xt,[e("div",Yt,[t[24]||(t[24]=e("h3",null,"정말 탈퇴하시겠습니까?",-1)),t[25]||(t[25]=e("p",null,"탈퇴 후 정보는 복구할 수 없습니다.",-1)),e("div",Zt,[e("button",{class:"btn-outline",onClick:t[3]||(t[3]=a=>X.value=!1)},"취소"),e("button",{class:"btn-red",onClick:Ce},"탈퇴")])])])):E("",!0)]),Y.value?(o(),s("div",ea,[e("div",ta,[t[26]||(t[26]=e("h3",null,"비밀번호 변경",-1)),e("div",aa,[e("div",la,r(h.value.email),1),e("button",{class:"btn-outline",disabled:v(d).sending||v(d).emailVerified,onClick:Ie},[v(d).sending?(o(),s("span",oa,"요청 중...")):v(d).codeSent&&!v(d).emailVerified?(o(),s("span",na,"재요청")):(o(),s("span",ia,"인증 요청"))],8,sa)]),e("div",da,[u(e("input",{"onUpdate:modelValue":t[4]||(t[4]=a=>v(d).code=a),placeholder:"인증번호 입력",class:"input",disabled:v(d).emailVerified},null,8,ca),[[p,v(d).code]]),e("button",{class:"btn-red",disabled:v(d).emailVerified,onClick:Pe}," 확인 ",8,ra)]),v(d).emailVerified?(o(),s("p",ua,"✔ 인증 완료")):E("",!0),v(d).verifyFail?(o(),s("p",va,"❌ 인증 실패")):E("",!0),!v(d).emailVerified&&v(d).timer>0?(o(),s("p",pa," ⏳ "+r(v(d).timer)+"초 남음 ",1)):E("",!0),u(e("input",{type:"password",class:"input",placeholder:"새 비밀번호","onUpdate:modelValue":t[5]||(t[5]=a=>w.value=a),style:{"margin-top":"12px"}},null,512),[[p,w.value]]),u(e("input",{type:"password",class:"input",placeholder:"새 비밀번호 확인","onUpdate:modelValue":t[6]||(t[6]=a=>B.value=a),style:{"margin-top":"8px"}},null,512),[[p,B.value]]),e("div",ma,[e("button",{class:"btn-outline",onClick:t[7]||(t[7]=a=>Y.value=!1)},"취소"),e("button",{class:"btn-red",onClick:Ve},"변경")])])])):E("",!0),q.value?(o(),s("div",{key:1,class:"modal-overlay edit-template-modal",onClick:Ke(ce,["self"])},[e("div",ya,[t[35]||(t[35]=e("h2",{class:"modal-title"},"템플릿 수정하기",-1)),e("div",ha,[e("div",fa,[e("div",_a,[t[27]||(t[27]=e("label",null,"템플릿 제목",-1)),u(e("input",{"onUpdate:modelValue":t[8]||(t[8]=a=>S.value=a),class:"input",type:"text",placeholder:"예: 7일 분할 루틴"},null,512),[[p,S.value]]),t[28]||(t[28]=e("label",null,"설명",-1)),u(e("textarea",{"onUpdate:modelValue":t[9]||(t[9]=a=>A.value=a),class:"textarea",placeholder:"템플릿 설명을 입력하세요"},null,512),[[p,A.value]]),t[29]||(t[29]=e("label",null,"가격",-1)),u(e("input",{"onUpdate:modelValue":t[10]||(t[10]=a=>V.value=a),class:"input",type:"number",min:"0",placeholder:"가격을 입력하세요 (숫자만)"},null,512),[[p,V.value,void 0,{number:!0}]])]),e("div",ba,[(o(),s(b,null,I(7,a=>e("button",{key:a,class:ue(["day-tab",{active:C.value===a}]),onClick:c=>C.value=a}," Day "+r(a),11,ka)),64))]),e("div",ga,[e("h3",null,"Day "+r(C.value)+" 운동 목록",1),(o(!0),s(b,null,I(m.value[C.value],(a,c)=>(o(),s("div",{key:c,class:"exercise-item"},[u(e("input",{"onUpdate:modelValue":i=>a.name=i,class:"input-sm",placeholder:"운동명"},null,8,wa),[[p,a.name]]),u(e("input",{"onUpdate:modelValue":i=>a.reps=i,class:"input-sm",type:"number",placeholder:"횟수"},null,8,Ca),[[p,a.reps,void 0,{number:!0}]]),u(e("input",{"onUpdate:modelValue":i=>a.weight=i,class:"input-sm",type:"number",placeholder:"무게(kg)"},null,8,Ea),[[p,a.weight,void 0,{number:!0}]]),u(e("input",{"onUpdate:modelValue":i=>a.duration=i,class:"input-sm",type:"number",placeholder:"시간(sec)"},null,8,Ia),[[p,a.duration,void 0,{number:!0}]]),u(e("select",{"onUpdate:modelValue":i=>a.part=i,class:"input-sm",onChange:i=>Be(a)},[t[30]||(t[30]=e("option",{value:null},"부위 선택",-1)),(o(!0),s(b,null,I(ie.value,i=>(o(),s("option",{key:i.id,value:i.code},r(i.name),9,Va))),128))],40,Pa),[[pe,a.part]]),u(e("select",{"onUpdate:modelValue":i=>a.equipmentId=i,class:"input-sm"},[t[31]||(t[31]=e("option",{value:null},"장비 없음",-1)),(o(!0),s(b,null,I(O.value[a.part]||[],i=>(o(),s("option",{key:i.id,value:i.id},r(i.name),9,Ua))),128))],8,Da),[[pe,a.equipmentId]]),e("button",{class:"delete-btn",onClick:i=>Re(c)}," 삭제 ",8,Sa)]))),128)),e("button",{class:"add-btn",onClick:Ne}," + 운동 추가 ")])]),e("div",Aa,[t[34]||(t[34]=e("h3",{class:"right-title"},"이미지 수정",-1)),e("div",Ma,[t[32]||(t[32]=e("label",null,"썸네일 이미지",-1)),e("input",{type:"file",onChange:xe},null,32),e("div",Ta,[M.value?(o(),s("img",{key:0,src:M.value,class:"image-preview"},null,8,Na)):(o(),s("div",Ra," 현재 이미지를 유지합니다. "))])]),e("div",Ba,[t[33]||(t[33]=e("label",null,"상세 이미지",-1)),e("input",{type:"file",onChange:Fe},null,32),e("div",xa,[T.value?(o(),s("img",{key:0,src:T.value,class:"image-preview"},null,8,Fa)):(o(),s("div",La," 현재 이미지를 유지합니다. "))])])])]),e("div",{class:"bottom-buttons"},[e("button",{class:"submit-btn",onClick:Le},"수정하기"),e("button",{class:"cancel-btn",onClick:ce},"닫기")])])])):E("",!0)],64))}},Ha=Oe($a,[["__scopeId","data-v-1a419531"]]);export{Ha as default};
